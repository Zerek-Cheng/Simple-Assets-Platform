{"version":3,"file":"js/upload-b076d3b0.js","mappings":"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","sources":["webpack://element/./src/views/UploadView.vue","webpack://element/src/views/UploadView.vue","webpack://element/./src/views/UploadView.vue?b58c","webpack://element/./src/views/UploadView.vue?a75c"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('el-row',[_c('el-col',{attrs:{\"md\":{span:16,push: 4},\"xs\":{span:22,push:1}}},[_c('el-card',{scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('el-col',{staticStyle:{\"display\":\"inline-block\",\"width\":\"auto\",\"margin-right\":\"1.5em\"},attrs:{\"id\":\"title-col\"}},[_c('h1',[_vm._v(\"图片上传\")])]),(_vm.user)?_c('el-col',{attrs:{\"id\":\"upload-setting\",\"xs\":24,\"md\":18}},[_c('el-checkbox',{ref:\"isPublic\",attrs:{\"value\":true},model:{value:(_vm.isPublic),callback:function ($$v) {_vm.isPublic=$$v},expression:\"isPublic\"}},[_vm._v(\" 公共可见 \")]),_c('el-date-picker',{ref:\"datetime\",attrs:{\"type\":\"datetime\",\"placeholder\":\"限时[可选]\",\"time-arrow-control\":true},model:{value:(_vm.dateLimit),callback:function ($$v) {_vm.dateLimit=$$v},expression:\"dateLimit\"}}),_c('el-input',{ref:\"timesLimit\",attrs:{\"placeholder\":\"限次[可选]\",\"max\":\"10000\",\"type\":\"number\",\"id\":\"upload-setting-times-limit\"},model:{value:(_vm.timesLimit),callback:function ($$v) {_vm.timesLimit=$$v},expression:\"timesLimit\"}},[_c('template',{slot:\"append\"},[_vm._v(\"次\")])],2)],1):_vm._e()]},proxy:true}])},[(!this.user)?_c('el-alert',{attrs:{\"id\":\"login-warn\",\"title\":\"未登录\",\"type\":\"error\",\"description\":\"只有登录后才能上传图片，点击上方按钮登录\",\"show-icon\":\"\"}}):_vm._e(),_c('el-divider'),_c('el-upload',{ref:\"upload\",staticClass:\"upload\",attrs:{\"disabled\":!_vm.user,\"action\":\"/api/upload\",\"list-type\":\"picture\",\"file-list\":_vm.files,\"limit\":10,\"auto-upload\":false,\"with-credentials\":true,\"headers\":{'X-XSRF-TOKEN': _vm.csrf},\"http-request\":_vm.requestUpload,\"on-success\":_vm.onSuccess,\"on-preview\":_vm.onPreview,\"accept\":\".jpg,.jpeg,.png,.gif,.bmp,.webp,.svg,.tiff\",\"drag\":\"\",\"multiple\":\"\"}},[_c('div',{staticClass:\"el-upload__text\"},[_c('p',[_c('i',{staticClass:\"el-icon-upload\"})]),_vm._v(\" 将文件拖到此处，或\"),_c('em',[_vm._v(\"点击这里\")])])]),(this.user)?_c('el-button',{attrs:{\"type\":\"success\",\"id\":\"confirm\"},on:{\"click\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.confirmUpload.apply(null, arguments)}}},[_vm._v(\" 确认上传 \")]):_vm._e()],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <el-row>\n    <el-col :md=\"{span:16,push: 4}\" :xs=\"{span:22,push:1}\">\n      <el-card>\n        <template v-slot:header>\n          <el-col style=\"display: inline-block;width: auto;margin-right: 1.5em;\" id=\"title-col\">\n            <h1>图片上传</h1>\n          </el-col>\n          <el-col id=\"upload-setting\" :xs=\"24\" :md=\"18\" v-if=\"user\">\n            <el-checkbox v-model=\"isPublic\"\n                         :value=\"true\"\n                         ref=\"isPublic\">\n              公共可见\n            </el-checkbox>\n            <el-date-picker\n                v-model=\"dateLimit\"\n                type=\"datetime\"\n                placeholder=\"限时[可选]\"\n                :time-arrow-control=\"true\" ref=\"datetime\">\n            </el-date-picker>\n            <el-input placeholder=\"限次[可选]\" v-model=\"timesLimit\" max=\"10000\"\n                      type=\"number\" ref=\"timesLimit\"\n                      id=\"upload-setting-times-limit\">\n              <template slot=\"append\">次</template>\n            </el-input>\n          </el-col>\n        </template>\n        <el-alert\n            v-if=\"!this.user\"\n            id=\"login-warn\"\n            title=\"未登录\"\n            type=\"error\"\n            description=\"只有登录后才能上传图片，点击上方按钮登录\"\n            show-icon>\n        </el-alert>\n        <el-divider></el-divider>\n        <el-upload\n            ref=\"upload\"\n            :disabled=\"!user\"\n            class=\"upload\"\n            action=\"/api/upload\"\n            list-type=\"picture\"\n            :file-list=\"files\"\n            :limit=\"10\"\n            :auto-upload=\"false\"\n            :with-credentials=\"true\"\n            :headers=\"{'X-XSRF-TOKEN': csrf}\"\n            :http-request=\"requestUpload\"\n            :on-success=\"onSuccess\"\n            :on-preview=\"onPreview\"\n            accept=\".jpg,.jpeg,.png,.gif,.bmp,.webp,.svg,.tiff\"\n            drag\n            multiple>\n          <div class=\"el-upload__text\">\n            <p><i class=\"el-icon-upload\"></i></p>\n            将文件拖到此处，或<em>点击这里</em></div>\n        </el-upload>\n        <el-button v-if=\"this.user\" type=\"success\" id=\"confirm\" @click.prevent.stop=\"confirmUpload\">\n          确认上传\n        </el-button>\n      </el-card>\n    </el-col>\n  </el-row>\n</template>\n<script>\nimport {mapState} from 'vuex';\n\nexport default {\n  data: () => ({\n    files: [],\n    isPublic: true,\n    dateLimit: null,\n    timesLimit: null,\n  }),\n  watch: {\n    isPublic(v) {\n      this.$cookies.set('isPublic', v);\n    },\n    dateLimit(v) {\n      if (v && v > Date.now()) {\n        this.$cookies.set('dateLimit', v);\n        return;\n      }\n      this.dateLimit = null;\n      this.$cookies.remove('dateLimit');\n    },\n    timesLimit(v) {\n      if (v && v > 0) {\n        this.$cookies.set('timesLimit', v);\n        return;\n      }\n      this.timesLimit = null;\n      this.$cookies.remove('timesLimit');\n    },\n  },\n  computed: {\n    ...mapState(['user', 'csrf'])\n  },\n  beforeMount() {\n    this.isPublic = this.$cookies.get('isPublic') === undefined ? true : !!JSON.parse(this.$cookies.get('isPublic'));\n    this.dateLimit = this.$cookies.get('dateLimit') === undefined ? null : new Date(this.$cookies.get('dateLimit'));\n    this.timesLimit = this.$cookies.get('timesLimit') === undefined ? null : this.$cookies.get('timesLimit');\n  },\n  methods: {\n    completeData(config) {\n      const data = {};\n      data.isPublic = this.isPublic;\n      data.file = config.file;\n      if (this.dateLimit) data.dataLimit = this.dateLimit.getTime();\n      if (this.timesLimit) data.timesLimit = this.timesLimit;\n      return data;\n    },\n    confirmUpload() { // 确认上传\n      this.$refs.upload.submit()\n    },\n    requestUpload(config) {\n      this.$axios.request({\n        method: 'post',\n        url: config.action,\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n        data: this.completeData(config),\n      })\n          .then((res) => config.onSuccess(res.data, config.file))\n          .catch((err) => config.onError(err, config.file))\n    },\n    onSuccess(res, file) { // 判断上传是否成功\n      if (res.code === -1) {\n        file.status = 'error'\n        this.$message.error(res.message)\n      }\n    },\n    onPreview(file) { // 预览图片\n      if (!file.response || file.response.code !== 0) return;\n      window.open(this.$router.resolve({\n        name: 'pic-info',\n        params: {pic: file.response.data.id}\n      }).href)\n    },\n  }\n}\n</script>\n<style lang=\"scss\">\n\n.upload {\n  margin-top: 1vw;\n\n  .el-upload-dragger, .el-upload {\n    width: 100%;\n    height: 50vh;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n  }\n}\n\n#upload-setting-times-limit + .el-input-group__append {\n  line-height: 1em;\n}\n\n</style>\n<style scoped lang=\"scss\">\n#upload-setting {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  column-gap: 1em;\n\n  * {\n    width: auto;\n    font-size: 1rem;\n  }\n\n  @media screen and (max-width: 990px) {\n    text-align: center;\n    flex-wrap: wrap;\n    * {\n      line-height: 300%;\n      width: 100%;\n    }\n  }\n}\n\n#confirm { // 上传按钮\n  margin-top: 1vw;\n  width: 100%;\n  height: 5vh;\n}\n\n#login-warn { //未登录提示\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-top: -1vh;\n  margin-bottom: 1vh;\n  line-height: 1.5rem;\n}\n\n</style>\n","import mod from \"-!../../node_modules/.pnpm/thread-loader@3.0.4_webpack@5.74.0/node_modules/thread-loader/dist/cjs.js!../../node_modules/.pnpm/babel-loader@8.2.5_rhsdbzevgb5tizdhlla5jsbgyu/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/.pnpm/vue-loader@15.10.0_qf5rw5wrxvbkf64bhcoybdhy2i/node_modules/vue-loader/lib/index.js??vue-loader-options!./UploadView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/.pnpm/thread-loader@3.0.4_webpack@5.74.0/node_modules/thread-loader/dist/cjs.js!../../node_modules/.pnpm/babel-loader@8.2.5_rhsdbzevgb5tizdhlla5jsbgyu/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/.pnpm/vue-loader@15.10.0_qf5rw5wrxvbkf64bhcoybdhy2i/node_modules/vue-loader/lib/index.js??vue-loader-options!./UploadView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UploadView.vue?vue&type=template&id=188ce346&scoped=true&\"\nimport script from \"./UploadView.vue?vue&type=script&lang=js&\"\nexport * from \"./UploadView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./UploadView.vue?vue&type=style&index=0&id=188ce346&prod&lang=scss&\"\nimport style1 from \"./UploadView.vue?vue&type=style&index=1&id=188ce346&prod&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/.pnpm/vue-loader@15.10.0_qf5rw5wrxvbkf64bhcoybdhy2i/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"188ce346\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","attrs","span","push","scopedSlots","_u","key","fn","staticStyle","_v","user","ref","model","value","isPublic","callback","$$v","expression","dateLimit","timesLimit","slot","_e","proxy","staticClass","files","csrf","requestUpload","onSuccess","onPreview","on","$event","preventDefault","stopPropagation","confirmUpload","apply","arguments","staticRenderFns","data","watch","computed","beforeMount","methods","completeData","method","url","headers","then","res","catch","err","file","window","name","params","pic","href","component"],"sourceRoot":""}